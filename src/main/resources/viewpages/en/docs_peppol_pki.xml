<!--

    Copyright (C) 2014-2025 Philip Helger (www.helger.com)
    philip[at]helger[dot]com

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<p>
  This article outlines the details of the Peppol PKI.
  It shows how the PKI is structured and where it is used.
  See the page on <a href="/public/menuitem-docs-peppol-cert-update">Peppol Certificate update</a> for the specifics on this process.
</p>

<div class="card">
  <div class="card-header">
    Table of contents
  </div>
  <div class="card-body">
    <ol>
      <li><a href="#pki4">Peppol PKI G3 (v4)</a></li>
      <li><a href="#pki3">Peppol PKI G2 (v3)</a></li>
      <li><a href="#usage">Certificate usage in Peppol</a></li>
    </ol>
  </div>
</div>

<a name="pki4"></a>
<h2>OpenPeppol PKI G3 (v4) - since 2025</h2>

<p>
  The PKI is called "OpenPeppol PKI G3" and the root certificates are valid from 2025 to 2035.
  The "G3" stems from the fact, that this is the third generation of OpenPeppol certificates hosted with Digicert.
  Previously there was another PKI in place which was the fourth version.
  The structure is similar to the previous G2 (v3) one and looks like this:
</p>

<p>
  <img src="../imgs/pki-structure-g3.png" alt="Peppol PKI G3 (v4) structure" />
</p>


<p>
  The migration process is as follows:
</p>

<ul>
  <li>
    August 2025
    <ul>
      <li>the new root certificates are available for download in 
        <a href="https://openpeppol.atlassian.net/wiki/spaces/OPMA/pages/4344053761/Peppol+PKI+2025+-+Certificate+Authorities">OpenPeppol Confluence</a>.</li>
      <li>Predefined Peppol truststores in PKCS12 format are available at 
        <a href="https://github.com/phax/peppol-commons/tree/master/peppol-commons/src/main/resources/truststore">https://github.com/phax/peppol-commons/tree/master/peppol-commons/src/main/resources/truststore</a>
        for AP and SMP separate for Test and Production Peppol Network.
        Note: no <em>complete truststore</em> is provided, as it is deemed insecure to trust test messages in production and vice versa</li>  
    </ul>
  </li>
  <li>
    Before 11 February 2026:
    <ul>
      <li>Ask for Peppol G3 test certificates</li>
      <li>Install the new Peppol G3 test certificates in your test environments</li>
      <li>Finish the Peppol Testbed "PKI Migration Test Suite" and store the completion PDF locally</li>
      <li>Make sure your production system can trust G2 and G3 PKIs in parallel</li>
    </ul> 
  </li>
  <li>
    Between 11 February and 31 March 2026:
    <ul>
      <li>Request for Peppol G3 production certificates.</li>
      <li>Install the new Peppol G3 production certificates in your production environments</li>
    </ul>
    From this date on, no new Peppol G2 production certificates will be issued.
  </li>
</ul>

<p>
  For details and further information, please see the 
  <a href="https://openpeppol.atlassian.net/wiki/spaces/OPMA/pages/3977936899/Peppol+PKI+2025+-+Certificate+Authority+Migration+Plan">Peppol PKI 2025 - Certificate Authority Migration Plan</a>
  and the 
  <a href="https://openpeppol.atlassian.net/wiki/spaces/OPMA/pages/4439080961/Peppol+PKI+2025+-+Issuing+and+Enrolment+Process">Peppol PKI 2025 - Issuing and Enrolment Process</a>
  pages.
</p> 

<a name="pki3"></a>
<h2>OpenPeppol PKI G2 (v3) - 2018 to 2026</h2>

<p>
  The PKI is called "OpenPeppol PKI v3" and the root certificates are valid from 2018 to 2028.
  The structure is very similar to the previous V2 one, but the STS CA is not present any more. So this is how it looks like:
</p>

<p>
  <img src="../imgs/pki-structure-g2.png" alt="Peppol PKI G2 (v3) structure" />
</p>

<p>
  The migration process was as follows:
</p>

<ul>
  <li>
    <div>
    February 2018: the new root certificates are available for download in 
      <a href="https://openpeppol.atlassian.net/wiki/spaces/OPMA/pages/193069072/Introduction+to+the+revised+PKI+Certificate+infrastructure+and+issuing+process">Confluence</a>
      and from
      <a href="https://github.com/OpenPeppol/documentation/tree/master/TransportInfrastructure/RootCertificates%202018">GitHub</a>
    </div>
    <div>
      Complete JKS files with all of the new root certificates are available at 
      <a href="https://github.com/phax/peppol-commons/tree/master/peppol-commons/src/main/resources/truststore">https://github.com/phax/peppol-commons/tree/master/peppol-commons/src/main/resources/truststore</a>.
      The recommended one is <code>complete-truststore.jks</code> as it contains all certificates.
    </div>
  </li>
  <li>
    16 April 2018: the certificate issuing process will begin and members are urged to request their PKI v3 certificate
  </li>
  <li>
    31 August 2018: OpenPeppol will no longer issue the old certificate types
  </li>
  <li>
    3 September 2018: the new certificates can be used in production
  </li>
</ul>

<p>
  For details and further information, please see the 
  <a href="https://openpeppol.atlassian.net/wiki/spaces/OPMA/pages/193069072/DRAFT+-+Introduction+to+the+revised+PKI+Certificate+infrastructure+and+issuing+process">DRAFT - Introduction to the revised PKI Certificate infrastructure and issuing process</a>
  and the 
  <a href="https://openpeppol.atlassian.net/wiki/spaces/OPMA/pages/189530542/PKI+Certificate+Migration+2018">PKI Certificate Migration 2018</a>
  pages.
</p> 

<a name="usage"></a>
<h2>Certificate usage in Peppol</h2>

<p>
  This section tries to give a rough overview where certificates are used for what purpose.
</p>

<ul>
  <li>
    <strong>SMP Server</strong>
    <ul>
      <li>
        Uses the Peppol SMP certificate to sign responses to <code>SignedServiceMetadata</code> requests
          (as in <code>http://smp.example.org/{participantID}/services/{docTypeID}</code> - will be <code>https</code> requiring a TLS certificate from November 1<sup>st</sup>, 2025)
      </li>
      <li>
        Uses the Peppol SMP certificate as a client certificate when communicating with the SML
          (for service group creation and deletion) 
      </li>
      <li>
        Requires the public part of the Peppol AP certificate for usage in the public
          endpoints (the information that is queried from the outside).
      </li>
      <li>
        Optionally uses the Peppol SMP certificate as a client certificate when communicating with the 
          Peppol Directory (for business card updates and deletions) 
      </li>
    </ul>
  </li>
  <li>
    <strong>SMP Client</strong>
    <ul>
      <li>
        Verifies that the response from the SMP server was signed by a valid Peppol SMP certificate
      </li>
    </ul>
  </li>
  <li>
    <strong>AP Server</strong> (receiving documents)
    <ul>
      <li>
        Requires a SSL/TLS certificate for https usage. 
        This SSL/TLS certificate is <strong>NOT</strong> issued by OpenPeppol but must be issued by a trusted third party.
        This SSL/TLS certificate should not be self-signed! 
      </li>
      <li>
        Verifies that the incoming document was signed with a Peppol AP certificate.
      </li>
    </ul>
  </li>
  <li>
    <strong>AP Client</strong> (sending documents)
    <ul>
      <li>
        Signs the AS4 message with the Peppol AP certificate.
        Includes the public part of the certificate inside the AS4 message.
      </li>
    </ul>
  </li>
  <li>
    <strong>SMK/SML</strong>
    <ul>
      <li>The SMK requires requests to contain an SMP Pilot Certificate to perform writing operations (mTLS)</li>
      <li>The SML requires requests to contain an SMP Production Certificate to perform writing operations (mTLS)</li>
    </ul>
  </li>
  <li>
    <strong>Peppol Directory</strong>
    <ul>
      <li>The test Peppol Directory requires requests to contain an SMP Pilot Certificate to perform writing operations (mTLS)</li>
      <li>The production Peppol Directory requires requests to contain an SMP Production Certificate to perform writing operations (mTLS)</li>
    </ul>
  </li>
</ul>
